<section
    class="a5e-js-sheet-page a5e-sheet__tab-content a5e-sheet__tab-content--spells {{#unless (eq currentTab 'spells')}}a5e-sheet__tab-content--hidden{{/unless}}"
    data-group="main"
    data-tab="spells"
>
    <div class="a5e-filter-container a5e-box">
        <h2 class="a5e-heading a5e-heading--filter a5e-heading--center">
            {{ localize "A5E.Filters" }}
        </h2>

        <div class="a5e-form-group">
            <h3 class="a5e-form__input-label">{{localize "A5E.FilterLabelSpellComponents"}}</h3>

            <ul class="a5e-tag-group a5-etag-group--small">
                {{#each config.spellComponents as | component key | }}
                    <li
                        class="
                        a5e-tag
                        a5e-tag--small
                        a5e-tag--clickable
                        {{#if (contains ../filters.spellComponents.inclusive key)}}''
                        {{else if (contains ../filters.spellComponents.exclusive key)}}a5e-tag--red
                        {{else}}a5e-tag--inactive
                        {{/if}}
                        a5e-js-toggle-filter
                    "
                        data-item-type="spell"
                        data-category="components"
                        data-value="{{key}}"
                    >
                        {{localize component}}
                    </li>
                {{/each}}
            </ul>
        </div>

        <div class="a5e-form-group">
            <h3 class="a5e-form__input-label">{{localize "A5E.FilterLabelSpellSchools"}}</h3>

            <ul class="a5e-tag-group a5-etag-group--small">
                {{#each config.spellSchools.primary as | school key | }}
                    <li
                        class="
                        a5e-tag
                        a5e-tag--small
                        a5e-tag--clickable
                        {{#if (contains ../filters.spellSchools.inclusive key)}}''
                        {{else if (contains ../filters.spellSchools.exclusive key)}}a5e-tag--red
                        {{else}}a5e-tag--inactive
                        {{/if}}
                        a5e-js-toggle-filter
                    "
                        data-item-type="spell"
                        data-category="school"
                        data-value="{{key}}"
                    >
                        {{localize school}}
                    </li>
                {{/each}}
            </ul>
        </div>

        <div class="a5e-form-group">
            <h3 class="a5e-form__input-label">{{localize "A5E.FilterLabelMiscellaneous"}}</h3>

            <ul class="a5e-tag-group a5-etag-group--small">
                <li
                    class="
                        a5e-tag
                        a5e-tag--small
                        a5e-tag--clickable
                        {{#if (contains filters.spellMiscellaneous.inclusive 'concentration')}}''
                        {{else if (contains filters.spellMiscellaneous.exclusive 'concentration')}}a5e-tag--red
                        {{else}}a5e-tag--inactive
                        {{/if}}
                        a5e-js-toggle-filter
                    "
                    data-item-type="spell"
                    data-category="miscellaneous"
                    data-value="concentration"
                >
                    {{localize "A5E.SpellConcentration"}}
                </li>

                <li
                    class="
                        a5e-tag
                        a5e-tag--small
                        a5e-tag--clickable
                        {{#if (contains filters.spellMiscellaneous.inclusive 'prepared')}}''
                        {{else if (contains filters.spellMiscellaneous.exclusive 'prepared')}}a5e-tag--red
                        {{else}}a5e-tag--inactive
                        {{/if}}
                        a5e-js-toggle-filter
                    "
                    data-item-type="spell"
                    data-category="miscellaneous"
                    data-value="prepared"
                >
                    {{localize "A5E.ItemPrepared"}}
                </li>

                <li
                    class="
                        a5e-tag
                        a5e-tag--small
                        a5e-tag--clickable
                        {{#if (contains filters.spellMiscellaneous.inclusive 'ritual')}}''
                        {{else if (contains filters.spellMiscellaneous.exclusive 'ritual')}}a5e-tag--red
                        {{else}}a5e-tag--inactive
                        {{/if}}
                        a5e-js-toggle-filter
                    "
                    data-item-type="spell"
                    data-category="miscellaneous"
                    data-value="ritual"
                >
                    {{localize "A5E.SpellRitual"}}
                </li>
            </ul>
        </div>

        <a
            class="a5e-button a5e-button--filter-reset a5e-js-reset-filters"
            data-item-type="spell"
        >
            {{localize "A5E.FiltersReset"}}
        </a>
    </div>

    <section class="a5e-items-container a5e-scroll-container a5e-js-spell-scroll-area">
        {{#each config.spellLevels as |label level|}}
            {{#if (contains ../availableSpellLevels level)}}
                <section class="a5e-item-group">
                    <header class="a5e-header a5e-header--spells">
                        <h3 class="a5e-heading a5e-heading--item-group">
                            {{ localize label }}
                        </h3>

                        {{#unless (eq level "0")}}
                            {{#if ../showSpellSlots}}
                                <div class="a5e-spell-slots">
                                    {{#with (lookup ../spellResources.slots level) as | resources |}}
                                        <input
                                            class="a5e-spell-slots__input"
                                            type="number"
                                            name="data.spellResources.slots.{{level}}.current"
                                            value="{{resources.current}}"
                                            data-dtype="Number"
                                            min="0"
                                            max="9"
                                        />
                                        /
                                        <input
                                            class="a5e-spell-slots__input"
                                            type="number"
                                            name="data.spellResources.slots.{{level}}.max"
                                            value="{{resources.max}}"
                                            data-dtype="Number"
                                            min="0"
                                            max="9"
                                        />
                                    {{/with}}
                                </div>
                            {{/if}}
                        {{/unless}}

                        <a
                            class="a5e-button a5e-button--add-item a5e-js-create-spell-item"
                            data-level="{{level}}"
                        >
                            + {{localize "A5E.SpellAdd"}}
                        </a>
                    </header>

                    <ul class="a5e-item-list">
                        {{#each (lookup ../items level) }}
                            <li
                                class="
                                    a5e-box
                                    a5e-item-list__item
                                    {{#if this.data.prepared}}a5e-box--green{{/if}}
                                    a5e-js-item
                                "
                                data-id="{{this._id}}"
                                data-item-id="{{this._id}}"
                                draggable="true"
                            >
                                <img
                                    src="{{this.img}}"
                                    title="{{this.name}}"
                                    class="a5e-image a5e-image--item-inline a5e-js-activate-item"
                                />

                                <span>{{this.name}}</span>

                                {{#if this.data.inlineLabels.length}}
                                    <div class="a5e-tag-group a5e-tag-group--small a5e-u-ml-auto">
                                        {{#each this.data.inlineLabels}}
                                            <div class="a5e-tag a5e-tag--small">
                                                {{this}}
                                            </div>
                                        {{/each}}
                                    </div>
                                {{/if}}

                                <div class="a5e-item-list__item-details">
                                    <hr class="a5e-rule">

                                    {{#if this.data.description}}
                                        {{{this.data.description}}}
                                    {{else}}
                                        {{localize "A5E.NoDescription"}}
                                    {{/if}}

                                    {{#if this.data.descriptionLabels.components.length}}
                                        <ul class="a5e-tag-group a5e-tag-group--small">
                                            {{#each this.data.descriptionLabels.components}}
                                                <li class="a5e-tag a5e-tag--small">{{this}}</li>
                                            {{/each}}
                                        </ul>
                                    {{/if}}

                                    {{#if this.data.descriptionLabels.schools.length}}
                                        <ul class="a5e-tag-group a5e-tag-group--small">
                                            {{#each this.data.descriptionLabels.schools}}
                                                <li class="a5e-tag a5e-tag--small">{{this}}</li>
                                            {{/each}}
                                        </ul>
                                    {{/if}}
                                </div>

                                <div class="a5e-context-menu">
                                    <a class="a5e-context-menu__option a5e-js-prepare-spell">
                                        <i class="fas fa-magic"></i>
                                        {{ localize "A5E.ItemTogglePreparation" }}
                                    </a>

                                    <a class="a5e-context-menu__option a5e-js-edit-item">
                                        <i class="fas fa-pen"></i>
                                        {{ localize "A5E.ItemEdit" }}
                                    </a>

                                    <hr class="a5e-rule">

                                    <a
                                        class="a5e-context-menu__option a5e-context-menu__option--delete a5e-js-delete-item">
                                        <i class="fas fa-trash"></i>
                                        {{ localize "A5E.ItemDelete" }}
                                    </a>
                                </div>
                            </li>
                        {{/each}}
                    </ul>
                </section>
            {{/if}}
        {{/each}}
    </section>

    <div class="a5e-sheet__bottom-bar a5e-sheet__bottom-bar--spells">
        {{#if showSpellPoints}}
            <div class="a5e-footer-group">
                <h3 class="a5e-u-mb-none">
                    {{localize "A5E.SpellPoints"}}
                </h3>

                <input
                    class="a5e-footer-group__input"
                    type="number"
                    name="data.spellResources.points.current"
                    value="{{spellResources.points.current}}"
                    placeholder="0"
                    min="0"
                    data-dtype="Number"
                >
                /
                <input
                    class="a5e-footer-group__input"
                    type="number"
                    name="data.spellResources.points.max"
                    value="{{spellResources.points.max}}"
                    placeholder="0"
                    min="0"
                    data-dtype="Number"
                >
            </div>
        {{/if}}

        <div class="a5e-footer-group a5e-footer-group--config">
            <h3 class="a5e-u-mb-none">{{ localize "A5E.ConfigureSpells"}}</h3>

            <i
                class="a5e-config-button a5e-config-button--large a5e-js-configure-spell-tab fas fa-cog">
            </i>
        </div>
    </div>
</section>
